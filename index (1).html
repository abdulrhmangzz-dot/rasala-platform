<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø±Ø³Ø§Ù„Ø© Ø´ÙƒØ±</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .login-container {
            max-width: 450px;
            margin: 100px auto;
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
        }
        .login-container h1 { color: #667eea; font-size: 2.5em; margin-bottom: 10px; }
        .login-container p { color: #666; margin-bottom: 40px; font-size: 1.1em; }
        .logo { font-size: 5em; margin-bottom: 20px; }
        .form-group { margin-bottom: 25px; text-align: right; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 1.1em; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.1em;
            transition: border 0.3s;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .btn {
            background: #667eea;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }
        .btn:hover { background: #5568d3; transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
        .btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .btn-danger { background: #dc3545; padding: 10px 20px; font-size: 1em; width: auto; }
        .btn-danger:hover { background: #c82333; }
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        .loading { display: none; text-align: center; padding: 20px; color: #667eea; font-size: 1.2em; }
        .switch-mode { margin-top: 20px; color: #666; }
        .switch-mode a { color: #667eea; text-decoration: none; font-weight: bold; cursor: pointer; }
        .switch-mode a:hover { text-decoration: underline; }
        .hidden { display: none !important; }
        .init-message {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div id="initScreen">
        <div class="login-container">
            <div class="logo">ğŸ–ï¸</div>
            <h1>Ù…Ù†ØµØ© Ø±Ø³Ø§Ù„Ø© Ø´ÙƒØ±</h1>
            <div class="init-message">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ©...</div>
        </div>
    </div>

    <div id="authScreen" class="hidden">
        <div class="login-container">
            <div class="logo">ğŸ–ï¸</div>
            <h1>Ù…Ù†ØµØ© Ø±Ø³Ø§Ù„Ø© Ø´ÙƒØ±</h1>
            <p>ØªÙˆØ«ÙŠÙ‚ ÙˆØªÙ‚Ø¯ÙŠØ± Ø§Ù„ÙƒÙˆØ§Ø¯Ø± Ø§Ù„Ø¹Ø§Ù…Ù„Ø©</p>
            
            <div id="loginForm">
                <div class="error-message" id="loginError"></div>
                <form onsubmit="return false;" id="loginFormElement">
                    <div class="form-group">
                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="loginEmail" required placeholder="example@email.com">
                    </div>
                    <div class="form-group">
                        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="loginPassword" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                    <button type="submit" class="btn" id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                </form>
                <div class="switch-mode">
                    Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a id="showRegisterLink">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a>
                </div>
            </div>
            
            <div id="registerForm" class="hidden">
                <div class="error-message" id="registerError"></div>
                <form onsubmit="return false;" id="registerFormElement">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ø¬Ù…Ø¹ÙŠØ© / Ø§Ù„Ù…Ù†Ø¸Ù…Ø©</label>
                        <input type="text" id="registerOrgName" required placeholder="Ø§Ø³Ù… Ø§Ù„Ø¬Ù…Ø¹ÙŠØ©">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="registerEmail" required placeholder="example@email.com">
                    </div>
                    <div class="form-group">
                        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="registerPassword" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" minlength="6">
                    </div>
                    <div class="form-group">
                        <label>ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="registerPasswordConfirm" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" minlength="6">
                    </div>
                    <button type="submit" class="btn" id="registerBtn">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
                </form>
                <div class="switch-mode">
                    Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ <a id="showLoginLink">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                </div>
            </div>
        </div>
    </div>

    <div id="mainApp" class="hidden">
        <div class="container">
            <div style="background: white; padding: 20px 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1 style="color: #667eea; font-size: 2em; margin-bottom: 5px;">ğŸ–ï¸ Ù…Ù†ØµØ© Ø±Ø³Ø§Ù„Ø© Ø´ÙƒØ±</h1>
                    <p id="orgName" style="color: #666;">ØªÙˆØ«ÙŠÙ‚ ÙˆØªÙ‚Ø¯ÙŠØ± Ø§Ù„ÙƒÙˆØ§Ø¯Ø±</p>
                </div>
                <div style="text-align: left;">
                    <div style="color: #999; font-size: 0.9em;">Ù…Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„:</div>
                    <div id="userEmail" style="color: #667eea; font-weight: bold;"></div>
                    <button id="logoutBtn" style="background: #dc3545; color: white; padding: 10px 25px; border: none; border-radius: 8px; cursor: pointer; font-size: 1em; font-weight: bold; margin-top: 10px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
            
            <div style="text-align: center; padding: 40px; color: white;">
                <h2 style="font-size: 2em; margin-bottom: 20px;">ğŸ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù†ØµØ© Ø±Ø³Ø§Ù„Ø© Ø´ÙƒØ±!</h2>
                <p style="font-size: 1.2em; margin-bottom: 30px;">Ø§Ù„Ù…Ù†ØµØ© Ø¬Ø§Ù‡Ø²Ø©! Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹...</p>
                <div style="background: rgba(255,255,255,0.2); padding: 30px; border-radius: 15px; max-width: 600px; margin: 0 auto;">
                    <h3 style="margin-bottom: 20px;">âœ… Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©:</h3>
                    <ul style="text-align: right; list-style: none; font-size: 1.1em; line-height: 2;">
                        <li>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬</li>
                        <li>ğŸ‘¥ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</li>
                        <li>ğŸ“ Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</li>
                        <li>ğŸ“š Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</li>
                        <li>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { getFirestore, collection, doc, setDoc, getDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyBxQqBFPXLdMKmlDRLDIfHUdMQlOzvC8Ww",
            authDomain: "khirya-q-681df.firebaseapp.com",
            projectId: "khirya-q-681df",
            storageBucket: "khirya-q-681df.firebasestorage.app",
            messagingSenderId: "576456168113",
            appId: "1:576456168113:web:709f0979b9650fa8ffc890"
        };
        
        let app, auth, db, currentUser, currentUserData;
        
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            console.log('âœ… Firebase initialized');
            
            document.getElementById('initScreen').classList.add('hidden');
            document.getElementById('authScreen').classList.remove('hidden');
            
            // Setup event listeners
            document.getElementById('showRegisterLink').addEventListener('click', () => {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('registerForm').classList.remove('hidden');
            });
            
            document.getElementById('showLoginLink').addEventListener('click', () => {
                document.getElementById('registerForm').classList.add('hidden');
                document.getElementById('loginForm').classList.remove('hidden');
            });
            
            document.getElementById('loginFormElement').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const btn = document.getElementById('loginBtn');
                btn.disabled = true;
                btn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
                
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                } catch (error) {
                    console.error(error);
                    showError('loginError', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
                    btn.disabled = false;
                    btn.textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                }
            });
            
            document.getElementById('registerFormElement').addEventListener('submit', async (e) => {
                e.preventDefault();
                const orgName = document.getElementById('registerOrgName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
                
                if (password !== passwordConfirm) {
                    showError('registerError', 'ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©');
                    return;
                }
                
                const btn = document.getElementById('registerBtn');
                btn.disabled = true;
                btn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';
                
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    await setDoc(doc(db, 'users', userCredential.user.uid), {
                        orgName, email, createdAt: serverTimestamp()
                    });
                    alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
                } catch (error) {
                    console.error(error);
                    let msg = 'Ø­Ø¯Ø« Ø®Ø·Ø£';
                    if (error.code === 'auth/email-already-in-use') msg = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹';
                    else if (error.code === 'auth/weak-password') msg = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© (6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)';
                    showError('registerError', msg);
                    btn.disabled = false;
                    btn.textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨';
                }
            });
            
            document.getElementById('logoutBtn').addEventListener('click', async () => {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                    await signOut(auth);
                }
            });
            
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    currentUser = user;
                    const userDoc = await getDoc(doc(db, 'users', user.uid));
                    if (userDoc.exists()) {
                        currentUserData = userDoc.data();
                        document.getElementById('orgName').textContent = currentUserData.orgName;
                    }
                    document.getElementById('userEmail').textContent = user.email;
                    document.getElementById('authScreen').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');
                } else {
                    currentUser = null;
                    currentUserData = null;
                    document.getElementById('mainApp').classList.add('hidden');
                    document.getElementById('authScreen').classList.remove('hidden');
                }
            });
            
        } catch (error) {
            console.error('Firebase Error:', error);
            document.getElementById('initScreen').innerHTML = 
                '<div class="login-container"><div class="logo">âŒ</div><h1 style="color: #dc3545;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ©</h1><p>Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹</p></div>';
        }
        
        function showError(id, msg) {
            const el = document.getElementById(id);
            el.textContent = msg;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }
    </script>
</body>
</html>
