<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø±Ø³Ø§Ù„Ø© Ø´ÙƒØ± - ØªÙˆØ«ÙŠÙ‚ ÙˆØªÙ‚Ø¯ÙŠØ± Ø§Ù„ÙƒÙˆØ§Ø¯Ø±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Login Screen */
        .login-container {
            max-width: 450px;
            margin: 100px auto;
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
        }
        
        .login-container h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .login-container p {
            color: #666;
            margin-bottom: 40px;
            font-size: 1.1em;
        }
        
        .login-container .logo {
            font-size: 5em;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 25px;
            text-align: right;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }
        
        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.1em;
            transition: border 0.3s;
            direction: ltr;
            text-align: left;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            background: #667eea;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }
        
        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: #6c757d;
            margin-top: 15px;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
        }
        
        .switch-mode {
            margin-top: 20px;
            color: #666;
        }
        
        .switch-mode a {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
        }
        
        .switch-mode a:hover {
            text-decoration: underline;
        }
        
        /* Main App Styles */
        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-content h1 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 5px;
        }
        
        .header-content p {
            color: #666;
            font-size: 1em;
        }
        
        .user-info {
            text-align: left;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .user-email {
            color: #667eea;
            font-weight: bold;
        }
        
        .btn-logout {
            background: #dc3545;
            color: white;
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
        }
        
        .btn-logout:hover {
            background: #c82333;
        }
        
        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            flex: 1;
            min-width: 200px;
            padding: 15px 30px;
            background: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .tab-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .tab-btn.active {
            background: #667eea;
            color: white;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.3s;
        }
        
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn-danger {
            background: #dc3545;
            padding: 10px 20px;
            font-size: 1em;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .participants-list {
            margin-top: 20px;
        }
        
        .participant-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .participant-info {
            flex: 1;
        }
        
        .participant-actions {
            display: flex;
            gap: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
        }
        
        .stat-card h3 {
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        .stat-card p {
            font-size: 1.2em;
        }
        
        .program-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-right: 5px solid #667eea;
        }
        
        .program-card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .certificate-preview {
            background: white;
            border: 3px solid #667eea;
            padding: 40px;
            margin: 20px 0;
            text-align: center;
            border-radius: 15px;
        }
        
        .certificate-preview h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: #667eea;
            color: white;
        }
        
        tr:hover {
            background: #f5f5f5;
        }
        
        .hidden {
            display: none !important;
        }

        .firebase-setup {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .firebase-setup h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .firebase-setup ol {
            text-align: right;
            padding-right: 20px;
        }

        .firebase-setup li {
            margin: 10px 0;
            line-height: 1.6;
        }

        .firebase-setup code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        .config-status {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .reset-config {
            background: #ffc107;
            color: #000;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- Firebase Setup Notice -->
    <div id="firebaseSetup" class="hidden">
        <div class="login-container" style="max-width: 700px;">
            <div class="logo">ğŸ”¥</div>
            <h1>Ø¥Ø¹Ø¯Ø§Ø¯ Firebase</h1>
            
            <div class="config-status" id="configStatus" style="display:none;">
                âœ… Firebase Ù…ÙÙØ¹Ù‘Ù„ Ø¨Ù†Ø¬Ø§Ø­!
                <button class="reset-config" onclick="resetFirebaseConfig()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯</button>
            </div>

            <div class="firebase-setup">
                <h3>ğŸ“‹ Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙØ¹ÙŠÙ„:</h3>
                <ol>
                    <li>Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰: <a href="https://console.firebase.google.com" target="_blank">console.firebase.google.com</a></li>
                    <li>Ø§ÙØªØ­ Ù…Ø´Ø±ÙˆØ¹Ùƒ: <strong>khirya-q</strong></li>
                    <li>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ âš™ï¸ â†’ Project settings</li>
                    <li>Ø§Ù†Ø²Ù„ Ù„Ù€ "Your apps" â†’ Ø§Ø¶ØºØ· Config</li>
                    <li>Ø§Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„Ø¶Ø¨Ø· ÙˆØ£Ù„ØµÙ‚Ù‡Ø§ Ø£Ø¯Ù†Ø§Ù‡:</li>
                </ol>
            </div>

            <form onsubmit="saveFirebaseConfig(event)">
                <div class="form-group">
                    <label>API Key *</label>
                    <input type="text" id="apiKey" required placeholder="AIzaSy...">
                </div>
                <div class="form-group">
                    <label>Auth Domain *</label>
                    <input type="text" id="authDomain" required placeholder="your-project.firebaseapp.com">
                </div>
                <div class="form-group">
                    <label>Project ID *</label>
                    <input type="text" id="projectId" required placeholder="your-project">
                </div>
                <div class="form-group">
                    <label>Storage Bucket *</label>
                    <input type="text" id="storageBucket" required placeholder="your-project.appspot.com">
                </div>
                <div class="form-group">
                    <label>Messaging Sender ID *</label>
                    <input type="text" id="messagingSenderId" required placeholder="123456789">
                </div>
                <div class="form-group">
                    <label>App ID *</label>
                    <input type="text" id="appId" required placeholder="1:123456789:web:abc123">
                </div>
                <button type="submit" class="btn">Ø­ÙØ¸ ÙˆØªÙØ¹ÙŠÙ„ Firebase ğŸ”¥</button>
            </form>
        </div>
    </div>

    <!-- Login/Register Screen -->
    <div id="authScreen" class="hidden">
        <div class="login-container">
            <div class="logo">ğŸ–ï¸</div>
            <h1>Ù…Ù†ØµØ© Ø±Ø³Ø§Ù„Ø© Ø´ÙƒØ±</h1>
            <p>ØªÙˆØ«ÙŠÙ‚ ÙˆØªÙ‚Ø¯ÙŠØ± Ø§Ù„ÙƒÙˆØ§Ø¯Ø± Ø§Ù„Ø¹Ø§Ù…Ù„Ø©</p>
            
            <div class="loading" id="authLoading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            
            <!-- Login Form -->
            <div id="loginForm">
                <div class="error-message" id="loginError"></div>
                <div class="success-message" id="loginSuccess"></div>
                
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="loginEmail" required placeholder="example@email.com">
                    </div>
                    
                    <div class="form-group">
                        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="loginPassword" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                    
                    <button type="submit" class="btn" id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                </form>
                
                <div class="switch-mode">
                    Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="#" onclick="showRegister(); return false;">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a>
                </div>
            </div>
            
            <!-- Register Form -->
            <div id="registerForm" class="hidden">
                <div class="error-message" id="registerError"></div>
                <div class="success-message" id="registerSuccess"></div>
                
                <form onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ø¬Ù…Ø¹ÙŠØ© / Ø§Ù„Ù…Ù†Ø¸Ù…Ø©</label>
                        <input type="text" id="registerOrgName" required placeholder="Ø§Ø³Ù… Ø§Ù„Ø¬Ù…Ø¹ÙŠØ©">
                    </div>
                    
                    <div class="form-group">
                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="registerEmail" required placeholder="example@email.com">
                    </div>
                    
                    <div class="form-group">
                        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="registerPassword" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" minlength="6">
                    </div>
                    
                    <div class="form-group">
                        <label>ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="registerPasswordConfirm" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" minlength="6">
                    </div>
                    
                    <button type="submit" class="btn" id="registerBtn">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
                </form>
                
                <div class="switch-mode">
                    Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ <a href="#" onclick="showLogin(); return false;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <div class="container">
            <div class="header">
                <div class="header-content">
                    <h1>ğŸ–ï¸ Ù…Ù†ØµØ© Ø±Ø³Ø§Ù„Ø© Ø´ÙƒØ±</h1>
                    <p id="orgName">ØªÙˆØ«ÙŠÙ‚ ÙˆØªÙ‚Ø¯ÙŠØ± Ø§Ù„ÙƒÙˆØ§Ø¯Ø± Ø§Ù„Ø¹Ø§Ù…Ù„Ø© ÙÙŠ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªÙ†Ù…ÙˆÙŠØ©</p>
                </div>
                <div class="user-info">
                    <div>
                        <div style="color: #999; font-size: 0.9em;">Ù…Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„:</div>
                        <div class="user-email" id="userEmail"></div>
                    </div>
                    <button class="btn-logout" onclick="handleLogout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
            
            <div class="tabs">
                <button class="tab-btn active" onclick="showTab('dashboard')">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
                <button class="tab-btn" onclick="showTab('programs')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬</button>
                <button class="tab-btn" onclick="showTab('participants')">Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</button>
                <button class="tab-btn" onclick="showTab('certificates')">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</button>
                <button class="tab-btn" onclick="showTab('archive')">Ø§Ù„Ø£Ø±Ø´ÙŠÙ</button>
            </div>
            
            <div class="loading" id="mainLoading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
            
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2 style="margin-bottom: 30px; color: #667eea;">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="totalPrograms">0</h3>
                        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalParticipants">0</h3>
                        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalCertificates">0</h3>
                        <p>Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙØ±Ø³Ù„Ø©</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="activePrograms">0</h3>
                        <p>Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù†Ø´Ø·Ø©</p>
                    </div>
                </div>
                
                <h3 style="margin: 30px 0 20px; color: #667eea;">ğŸ”¥ Ø¢Ø®Ø± Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬</h3>
                <div id="recentPrograms"></div>
            </div>
            
            <!-- Programs Tab -->
            <div id="programs" class="tab-content">
                <h2 style="margin-bottom: 30px; color: #667eea;">â• Ø¥Ø¶Ø§ÙØ© Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¬Ø¯ÙŠØ¯</h2>
                
                <div class="success-message" id="programSuccess">ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¨Ù†Ø¬Ø§Ø­! âœ…</div>
                
                <form id="programForm" onsubmit="addProgram(event)">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ *</label>
                        <input type="text" id="programName" required placeholder="Ù…Ø«Ø§Ù„: Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„ØµÙŠÙÙŠ 2024">
                    </div>
                    
                    <div class="form-group">
                        <label>ÙˆØµÙ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</label>
                        <textarea id="programDescription" rows="4" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ø¹Ù† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡ *</label>
                        <input type="date" id="programStartDate" required>
                    </div>
                    
                    <div class="form-group">
                        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ *</label>
                        <input type="date" id="programEndDate" required>
                    </div>
                    
                    <button type="submit" class="btn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</button>
                </form>
                
                <h3 style="margin: 40px 0 20px; color: #667eea;">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬</h3>
                <div id="programsList"></div>
            </div>
            
            <!-- Participants Tab -->
            <div id="participants" class="tab-content">
                <h2 style="margin-bottom: 30px; color: #667eea;">ğŸ‘¥ Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ù„Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</h2>
                
                <div class="success-message" id="participantSuccess">ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ Ø¨Ù†Ø¬Ø§Ø­! âœ…</div>
                
                <form id="participantForm" onsubmit="addParticipant(event)">
                    <div class="form-group">
                        <label>Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ *</label>
                        <select id="selectProgram" required>
                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ --</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ *</label>
                        <input type="text" id="participantName" required placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
                    </div>
                    
                    <div class="form-group">
                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label>
                        <input type="email" id="participantEmail" required placeholder="example@email.com">
                    </div>
                    
                    <div class="form-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
                        <input type="tel" id="participantPhone" placeholder="05xxxxxxxx">
                    </div>
                    
                    <div class="form-group">
                        <label>Ø§Ù„Ø¯ÙˆØ± ÙÙŠ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ *</label>
                        <select id="participantRole" required>
                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ± --</option>
                            <option value="Ù…Ø¯Ø±Ø¨">Ù…Ø¯Ø±Ø¨</option>
                            <option value="Ù…ØªØ·ÙˆØ¹">Ù…ØªØ·ÙˆØ¹</option>
                            <option value="Ù…Ù†Ø³Ù‚">Ù…Ù†Ø³Ù‚</option>
                            <option value="Ù…Ø´Ø±Ù">Ù…Ø´Ø±Ù</option>
                            <option value="Ù…Ø³Ø§Ø¹Ø¯">Ù…Ø³Ø§Ø¹Ø¯</option>
                            <option value="Ù…Ø­Ø§Ø¶Ø±">Ù…Ø­Ø§Ø¶Ø±</option>
                            <option value="Ù…Ù†Ø¸Ù…">Ù…Ù†Ø¸Ù…</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</button>
                </form>
                
                <h3 style="margin: 40px 0 20px; color: #667eea;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</h3>
                <div id="participantsList"></div>
            </div>
            
            <!-- Certificates Tab -->
            <div id="certificates" class="tab-content">
                <h2 style="margin-bottom: 30px; color: #667eea;">ğŸ“ Ø¥Ø±Ø³Ø§Ù„ Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ø´ÙƒØ±</h2>
                
                <div class="form-group">
                    <label>Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</label>
                    <select id="certificateProgram" onchange="loadProgramParticipants()">
                        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ --</option>
                    </select>
                </div>
                
                <div id="certificateParticipants"></div>
                
                <div class="certificate-preview" id="certificatePreview" style="display:none;">
                    <h2>Ø´Ù‡Ø§Ø¯Ø© ØªÙ‚Ø¯ÙŠØ±</h2>
                    <p style="font-size: 1.3em; margin: 20px 0;">ØªØªÙ‚Ø¯Ù… <span id="certOrgName"></span> Ø¨Ø§Ù„Ø´ÙƒØ± Ø§Ù„Ø¬Ø²ÙŠÙ„ Ø¥Ù„Ù‰</p>
                    <h3 style="color: #667eea; font-size: 2em; margin: 20px 0;" id="previewName">Ø§Ù„Ø§Ø³Ù…</h3>
                    <p style="font-size: 1.2em;">Ù„Ù…Ø´Ø§Ø±ÙƒØªÙ‡ ÙÙŠ Ø¨Ø±Ù†Ø§Ù…Ø¬:</p>
                    <h4 style="color: #764ba2; margin: 20px 0; font-size: 1.5em;" id="previewProgram">Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</h4>
                    <p style="font-size: 1.2em;">Ø¨ØµÙØ©: <strong id="previewRole">Ø§Ù„Ø¯ÙˆØ±</strong></p>
                    <p style="margin-top: 30px; color: #666;">Ø§Ù„ØªØ§Ø±ÙŠØ®: <span id="previewDate"></span></p>
                </div>
            </div>
            
            <!-- Archive Tab -->
            <div id="archive" class="tab-content">
                <h2 style="margin-bottom: 30px; color: #667eea;">ğŸ“š Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</h2>
                
                <div class="form-group">
                    <input type="text" id="searchArchive" placeholder="ğŸ” Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ..." onkeyup="searchArchive()">
                </div>
                
                <table id="archiveTable">
                    <thead>
                        <tr>
                            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</th>
                            <th>Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</th>
                            <th>Ø§Ù„Ø¯ÙˆØ±</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="archiveBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script>
        // Global variables
        let firebaseApp = null;
        let auth = null;
        let db = null;
        let currentUser = null;
        let currentUserData = null;
        let programs = [];
        let participants = [];
        let certificates = [];
        
        // Check Firebase Configuration
        function checkFirebaseConfig() {
            const config = localStorage.getItem('firebaseConfig');
            if (config) {
                try {
                    const firebaseConfig = JSON.parse(config);
                    initializeFirebase(firebaseConfig);
                    return true;
                } catch (error) {
                    console.error('Error parsing Firebase config:', error);
                    return false;
                }
            }
            return false;
        }
        
        // Reset Firebase Configuration
        function resetFirebaseConfig() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª FirebaseØŸ')) {
                localStorage.removeItem('firebaseConfig');
                location.reload();
            }
        }
        
        // Save Firebase Configuration
        function saveFirebaseConfig(e) {
            e.preventDefault();
            
            const config = {
                apiKey: document.getElementById('apiKey').value.trim(),
                authDomain: document.getElementById('authDomain').value.trim(),
                projectId: document.getElementById('projectId').value.trim(),
                storageBucket: document.getElementById('storageBucket').value.trim(),
                messagingSenderId: document.getElementById('messagingSenderId').value.trim(),
                appId: document.getElementById('appId').value.trim()
            };
            
            // Validate
            if (!config.apiKey || !config.authDomain || !config.projectId) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©!');
                return;
            }
            
            localStorage.setItem('firebaseConfig', JSON.stringify(config));
            initializeFirebase(config);
        }
        
        // Initialize Firebase
        function initializeFirebase(config) {
            try {
                console.log('Initializing Firebase with config:', config);
                firebaseApp = firebase.initializeApp(config);
                auth = firebase.auth();
                db = firebase.firestore();
                
                document.getElementById('firebaseSetup').classList.add('hidden');
                document.getElementById('authScreen').classList.remove('hidden');
                
                // Check if user is logged in
                auth.onAuthStateChanged(user => {
                    if (user) {
                        console.log('User logged in:', user.email);
                        currentUser = user;
                        loadUserData();
                    } else {
                        console.log('No user logged in');
                        showAuthScreen();
                    }
                });
            } catch (error) {
                console.error('Firebase initialization error:', error);
                alert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase:\n' + error.message + '\n\nØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!');
                localStorage.removeItem('firebaseConfig');
                location.reload();
            }
        }
        
        // Show/Hide screens
        function showAuthScreen() {
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }
        
        function showMainApp() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userEmail').textContent = currentUser.email;
            if (currentUserData) {
                document.getElementById('orgName').textContent = currentUserData.orgName;
                document.getElementById('certOrgName').textContent = currentUserData.orgName;
            }
        }
        
        function showLogin() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        }
        
        function showRegister() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }
        
        // Handle Register
        async function handleRegister(e) {
            e.preventDefault();
            
            const orgName = document.getElementById('registerOrgName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            
            if (password !== passwordConfirm) {
                showError('registerError', 'ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©');
                return;
            }
            
            const btn = document.getElementById('registerBtn');
            btn.disabled = true;
            btn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';
            
            try {
                console.log('Creating user with email:', email);
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                console.log('User created successfully:', user.uid);
                
                console.log('Saving user data to Firestore...');
                await db.collection('users').doc(user.uid).set({
                    orgName: orgName,
                    email: email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log('User data saved successfully');
                
                showSuccess('registerSuccess', 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...');
                
                setTimeout(() => {
                    currentUser = user;
                    loadUserData();
                }, 2000);
                
            } catch (error) {
                console.error('Registration error:', error);
                let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨: ' + error.message;
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹ (ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­';
                }
                showError('registerError', errorMessage);
                btn.disabled = false;
                btn.textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨';
            }
        }
        
        // Handle Login
        async function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const btn = document.getElementById('loginBtn');
            btn.disabled = true;
            btn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
            
            try {
                console.log('Logging in with email:', email);
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                console.log('Login successful:', currentUser.uid);
                await loadUserData();
                
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message;
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­';
                }
                showError('loginError', errorMessage);
                btn.disabled = false;
                btn.textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
            }
        }
        
        // Handle Logout
        async function handleLogout() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                try {
                    await auth.signOut();
                    currentUser = null;
                    currentUserData = null;
                    programs = [];
                    participants = [];
                    certificates = [];
                    showAuthScreen();
                } catch (error) {
                    console.error(error);
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬');
                }
            }
        }
        
        // Load user data from Firestore
        async function loadUserData() {
            try {
                console.log('Loading user data for:', currentUser.uid);
                document.getElementById('mainLoading').style.display = 'block';
                
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    currentUserData = userDoc.data();
                    console.log('User data loaded:', currentUserData);
                }
                
                const programsSnapshot = await db.collection('users').doc(currentUser.uid)
                    .collection('programs').orderBy('createdAt', 'desc').get();
                programs = programsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log('Programs loaded:', programs.length);
                
                const participantsSnapshot = await db.collection('users').doc(currentUser.uid)
                    .collection('participants').orderBy('addedAt', 'desc').get();
                participants = participantsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log('Participants loaded:', participants.length);
                
                const certificatesSnapshot = await db.collection('users').doc(currentUser.uid)
                    .collection('certificates').orderBy('sentAt', 'desc').get();
                certificates = certificatesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log('Certificates loaded:', certificates.length);
                
                document.getElementById('mainLoading').style.display = 'none';
                showMainApp();
                updateDashboard();
                
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('mainLoading').style.display = 'none';
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:\n' + error.message);
            }
        }
        
        // Show error message
        function showError(elementId, message) {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => {
                el.style.display = 'none';
            }, 5000);
        }
        
        // Show success message
        function showSuccess(elementId, message) {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => {
                el.style.display = 'none';
            }, 5000);
        }
        
        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'dashboard') updateDashboard();
            if (tabName === 'programs') loadProgramsList();
            if (tabName === 'participants') {
                loadProgramsDropdown();
                loadParticipantsList();
            }
            if (tabName === 'certificates') {
                loadCertificatesDropdown();
            }
            if (tabName === 'archive') loadArchive();
        }
        
        // Add Program
        async function addProgram(e) {
            e.preventDefault();
            
            const program = {
                name: document.getElementById('programName').value,
                description: document.getElementById('programDescription').value,
                startDate: document.getElementById('programStartDate').value,
                endDate: document.getElementById('programEndDate').value,
                status: 'Ù†Ø´Ø·',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                const docRef = await db.collection('users').doc(currentUser.uid)
                    .collection('programs').add(program);
                
                programs.unshift({ id: docRef.id, ...program, createdAt: new Date() });
                
                document.getElementById('programForm').reset();
                showSuccess('programSuccess', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¨Ù†Ø¬Ø§Ø­! âœ…');
                loadProgramsList();
                updateDashboard();
                
            } catch (error) {
                console.error(error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬:\n' + error.message);
            }
        }
        
        // Load Programs List
        function loadProgramsList() {
            const container = document.getElementById('programsList');
            if (programs.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø±Ø§Ù…Ø¬ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>';
                return;
            }
            
            container.innerHTML = programs.map(program => `
                <div class="program-card">
                    <h3>${program.name}</h3>
                    <p><strong>Ø§Ù„ÙˆØµÙ:</strong> ${program.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
                    <p><strong>Ø§Ù„ÙØªØ±Ø©:</strong> Ù…Ù† ${program.startDate} Ø¥Ù„Ù‰ ${program.endDate}</p>
                    <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span style="color: #28a745;">${program.status}</span></p>
                    <button class="btn btn-danger" onclick="deleteProgram('${program.id}')">Ø­Ø°Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</button>
                </div>
            `).join('');
        }
        
        // Delete Program
        async function deleteProgram(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ØŸ')) {
                try {
                    await db.collection('users').doc(currentUser.uid)
                        .collection('programs').doc(id).delete();
                    
                    programs = programs.filter(p => p.id !== id);
                    loadProgramsList();
                    updateDashboard();
                    
                } catch (error) {
                    console.error(error);
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬');
                }
            }
        }
        
        // Load Programs Dropdown
        function loadProgramsDropdown() {
            const select = document.getElementById('selectProgram');
            select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ --</option>' +
                programs.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
        }
        
        // Add Participant
        async function addParticipant(e) {
            e.preventDefault();
            
            const participant = {
                programId: document.getElementById('selectProgram').value,
                name: document.getElementById('participantName').value,
                email: document.getElementById('participantEmail').value,
                phone: document.getElementById('participantPhone').value,
                role: document.getElementById('participantRole').value,
                certificateSent: false,
                addedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                const docRef = await db.collection('users').doc(currentUser.uid)
                    .collection('participants').add(participant);
                
                participants.unshift({ id: docRef.id, ...participant, addedAt: new Date() });
                
                document.getElementById('participantForm').reset();
                showSuccess('participantSuccess', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ Ø¨Ù†Ø¬Ø§Ø­! âœ…');
                loadParticipantsList();
                updateDashboard();
                
            } catch (error) {
                console.error(error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ:\n' + error.message);
            }
        }
        
        // Load Participants List
        function loadParticipantsList() {
            const container = document.getElementById('participantsList');
            if (participants.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#999;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒÙˆÙ† Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>';
                return;
            }
            
            container.innerHTML = '<div class="participants-list">' + participants.map(p => {
                const program = programs.find(pr => pr.id === p.programId);
                return `
                    <div class="participant-item">
                        <div class="participant-info">
                            <strong>${p.name}</strong> - ${p.role}<br>
                            <small>Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬: ${program ? program.name : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} | ${p.email}</small>
                        </div>
                        <div class="participant-actions">
                            <button class="btn btn-danger" onclick="deleteParticipant('${p.id}')">Ø­Ø°Ù</button>
                        </div>
                    </div>
                `;
            }).join('') + '</div>';
        }
        
        // Delete Participant
        async function deleteParticipant(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØŸ')) {
                try {
                    await db.collection('users').doc(currentUser.uid)
                        .collection('participants').doc(id).delete();
                    
                    participants = participants.filter(p => p.id !== id);
                    loadParticipantsList();
                    updateDashboard();
                    
                } catch (error) {
                    console.error(error);
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ');
                }
            }
        }
        
        // Load Certificates Dropdown
        function loadCertificatesDropdown() {
            const select = document.getElementById('certificateProgram');
            select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ --</option>' +
                programs.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
        }
        
        // Load Program Participants for Certificates
        function loadProgramParticipants() {
            const programId = document.getElementById('certificateProgram').value;
            const container = document.getElementById('certificateParticipants');
            
            if (!programId) {
                container.innerHTML = '';
                return;
            }
            
            const programParticipants = participants.filter(p => p.programId === programId);
            
            if (programParticipants.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#999;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒÙˆÙ† ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</p>';
                return;
            }
            
            container.innerHTML = '<div class="participants-list">' + programParticipants.map(p => `
                <div class="participant-item">
                    <div class="participant-info">
                        <strong>${p.name}</strong> - ${p.role}<br>
                        <small>${p.email}</small>
                    </div>
                    <div class="participant-actions">
                        <button class="btn ${p.certificateSent ? 'btn-secondary' : ''}" 
                                onclick="sendCertificate('${p.id}', '${programId}')"
                                ${p.certificateSent ? 'disabled' : ''}>
                            ${p.certificateSent ? 'âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„' : 'ğŸ“§ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©'}
                        </button>
                        <button class="btn" onclick="previewCertificate('${p.id}', '${programId}')">
                            ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø©
                        </button>
                    </div>
                </div>
            `).join('') + '</div>';
        }
        
        // Preview Certificate
        function previewCertificate(participantId, programId) {
            const participant = participants.find(p => p.id === participantId);
            const program = programs.find(p => p.id === programId);
            
            document.getElementById('previewName').textContent = participant.name;
            document.getElementById('previewProgram').textContent = program.name;
            document.getElementById('previewRole').textContent = participant.role;
            document.getElementById('previewDate').textContent = new Date().toLocaleDateString('ar-SA');
            document.getElementById('certificatePreview').style.display = 'block';
            
            window.scrollTo({top: document.getElementById('certificatePreview').offsetTop - 100, behavior: 'smooth'});
        }
        
        // Send Certificate
        async function sendCertificate(participantId, programId) {
            const participant = participants.find(p => p.id === participantId);
            const program = programs.find(p => p.id === programId);
            
            // Generate PDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(22);
            doc.text('Certificate of Appreciation', 105, 40, {align: 'center'});
            
            doc.setFontSize(16);
            doc.text(`${currentUserData.orgName}`, 105, 55, {align: 'center'});
            doc.text(`This is to certify that`, 105, 75, {align: 'center'});
            
            doc.setFontSize(20);
            doc.text(participant.name, 105, 95, {align: 'center'});
            
            doc.setFontSize(14);
            doc.text(`Has participated in the program:`, 105, 115, {align: 'center'});
            doc.text(program.name, 105, 130, {align: 'center'});
            doc.text(`As: ${participant.role}`, 105, 150, {align: 'center'});
            doc.text(`Date: ${new Date().toLocaleDateString('ar-SA')}`, 105, 170, {align: 'center'});
            
            doc.save(`certificate_${participant.name}.pdf`);
            
            try {
                // Mark as sent in Firestore
                await db.collection('users').doc(currentUser.uid)
                    .collection('participants').doc(participantId).update({
                        certificateSent: true
                    });
                
                // Add to certificates log
                const certificate = {
                    participantId: participantId,
                    participantName: participant.name,
                    programId: program.id,
                    programName: program.name,
                    role: participant.role,
                    email: participant.email,
                    sentAt: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„'
                };
                
                await db.collection('users').doc(currentUser.uid)
                    .collection('certificates').add(certificate);
                
                // Update local data
                participant.certificateSent = true;
                certificates.unshift({ ...certificate, sentAt: new Date() });
                
                alert(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­!\n\nØ§Ù„Ù…Ø³ØªÙ„Ù…: ${participant.name}\nØ§Ù„Ø¨Ø±ÙŠØ¯: ${participant.email}\n\nØªÙ… ØªÙ†Ø²ÙŠÙ„ Ù†Ø³Ø®Ø© PDF Ù…Ù† Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©.`);
                
                loadProgramParticipants();
                updateDashboard();
                
            } catch (error) {
                console.error(error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©:\n' + error.message);
            }
        }
        
        // Load Archive
        function loadArchive() {
            const tbody = document.getElementById('archiveBody');
            
            if (certificates.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; color:#999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ù‡Ø§Ø¯Ø§Øª ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ</td></tr>';
                return;
            }
            
            tbody.innerHTML = certificates.map(c => `
                <tr>
                    <td>${c.participantName}</td>
                    <td>${c.programName}</td>
                    <td>${c.role}</td>
                    <td>${c.sentAt ? new Date(c.sentAt.toDate ? c.sentAt.toDate() : c.sentAt).toLocaleDateString('ar-SA') : ''}</td>
                    <td><span style="color: #28a745;">âœ… ${c.status}</span></td>
                    <td>
                        <button class="btn" onclick="resendCertificate('${c.participantId}', '${c.programId}')" style="padding: 8px 15px; font-size: 0.9em;">
                            ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        // Search Archive
        function searchArchive() {
            const searchTerm = document.getElementById('searchArchive').value.toLowerCase();
            const filtered = certificates.filter(c => 
                c.participantName.toLowerCase().includes(searchTerm) ||
                c.programName.toLowerCase().includes(searchTerm) ||
                c.role.toLowerCase().includes(searchTerm)
            );
            
            const tbody = document.getElementById('archiveBody');
            tbody.innerHTML = filtered.map(c => `
                <tr>
                    <td>${c.participantName}</td>
                    <td>${c.programName}</td>
                    <td>${c.role}</td>
                    <td>${c.sentAt ? new Date(c.sentAt.toDate ? c.sentAt.toDate() : c.sentAt).toLocaleDateString('ar-SA') : ''}</td>
                    <td><span style="color: #28a745;">âœ… ${c.status}</span></td>
                    <td>
                        <button class="btn" onclick="resendCertificate('${c.participantId}', '${c.programId}')" style="padding: 8px 15px; font-size: 0.9em;">
                            ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        // Resend Certificate
        function resendCertificate(participantId, programId) {
            sendCertificate(participantId, programId);
        }
        
        // Update Dashboard
        function updateDashboard() {
            document.getElementById('totalPrograms').textContent = programs.length;
            document.getElementById('totalParticipants').textContent = participants.length;
            document.getElementById('totalCertificates').textContent = certificates.length;
            document.getElementById('activePrograms').textContent = programs.filter(p => p.status === 'Ù†Ø´Ø·').length;
            
            const recentPrograms = programs.slice(0, 3);
            const container = document.getElementById('recentPrograms');
            
            if (recentPrograms.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø±Ø§Ù…Ø¬ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>';
                return;
            }
            
            container.innerHTML = recentPrograms.map(program => {
                const programParticipants = participants.filter(p => p.programId === program.id);
                return `
                    <div class="program-card">
                        <h3>${program.name}</h3>
                        <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†:</strong> ${programParticipants.length}</p>
                        <p><strong>Ø§Ù„ÙØªØ±Ø©:</strong> ${program.startDate} - ${program.endDate}</p>
                    </div>
                `;
            }).join('');
        }
        
        // Initialize on page load
        if (!checkFirebaseConfig()) {
            document.getElementById('firebaseSetup').classList.remove('hidden');
        }
    </script>
</body>
</html>
